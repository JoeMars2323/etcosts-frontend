<!-- create new expense-->
<div class="d-sm-flex align-items-center justify-content-between mb-4">
  <h1 class="h3 mb-0 text-blue">Criar nova despesa</h1>
</div>

<!--form expenses-->
<form #itemForm="ngForm" name="form" ngSubmit="onSubmit()">
  <div class="container-fluid">
    <div class="row">
      <!-- expense name -->
      <div class="col-sm-6" [class.has-error]="name.invalid && name.touched" [class.has-success]="name.valid">
        <label [attr.for]="name" class="control-label">Nome da despesa:</label>
        <input required [id]="name" name="expenseName" type="text" class="form-control" 
        [(ngModel)]="expense.expenseName" #name="ngModel">
        <span class="help-block" *ngIf="name.invalid && name.touched"> O nome da despesa é obrigatório</span>
      </div>

      <!-- expense type -->
      <div class="col-sm-6" [class.has-error]="type.touched" [class.has-success]="type.valid">
        <label [attr.for]="type">Tipo da despesa:</label>
        <select required [id]="type" name="itemName" class="form-control ml-1" 
        [(ngModel)]="expense.expenseType" #type="ngModel" (change)="getExpenseType()">
          <option *ngFor="let type of expenseType" [ngValue]="type">{{type}}</option>
          <span class="help-block" *ngIf="type.touched"> O tipo de despesa é obrigatório</span>
        </select>
      </div>
    </div>
    <br>
    <div class="row">
      <!-- date -->
      <div class="col-sm-6">
        <label for="expenseDate" class="control-label">Data:</label>
        <input required id="expenseDate" name="expenseDate" type="text" class="form-control" 
        [(ngModel)]="expense.expenseDate" bsDatepicker [bsConfig]="bsConfig">
      </div>
    </div>
  </div>
  <br>
  <hr>
  <!-- items -->
  <div class="container-fluid" *ngFor="let obj of dataArray; let i = index">
    <h4 class="mb-2 text-blue2">Items da despesa</h4><br>
    <h5 class="mb-2 text-gray-800">&nbsp;&nbsp;&nbsp;Item# {{i+1}}</h5><br>
    <div class="row">
      <!--item name-->
      <div class="col-sm-6" [class.has-error]="item.invalid && item.touched" [class.has-success]="item.valid">
        <label [attr.for]="'itemName'+i" class="control-label">Nome do item:</label>
        <input required [id]="'itemName'+i" name="itemName{{i}}" type="text" class="form-control" [(ngModel)]="obj.item" #item="ngModel">
        <span class="help-block" *ngIf="item.invalid && item.touched"> O nome do item é obrigatório</span>
      </div>
      <!--item description-->
      <div class="col-sm-6">
        <label for="description">Descrição:</label>
        <textarea id="description" name="description{{i}}" type="text" rows="1" class="form-control" [(ngModel)]="obj.description" ></textarea>
      </div>
    </div>
    <br>
    <div class="row">
      <!--currency-->
      <div class="col-sm-6">
        <label for="currency">Moeda:</label>
        <select required id="currency" name="currency{{i}}" class="form-control ml-1" [(ngModel)]="obj.currency" (change)="getCurrency()">
          <option *ngFor="let c of currency"[value]="c"> {{c}} </option>
        </select>
      </div>
      <!--value-->
      <div class="col-sm-6" [class.has-error]="val.invalid && val.touched" [class.has-success]="val.valid">
        <label for="value" class="control-label">Valor:</label>
        <input required id="value" name="value{{i}}" type="number" class="form-control"  
        [(ngModel)]="obj.itemValue" #val="ngModel" (blur)="valueSum()">
        <span class="help-block" *ngIf="val.invalid && val.touched"> O valor do item é obrigatório </span>
        <br>
      </div>
    </div>
    <br>
    <!--<label>Quer adicionar ficheiro?</label>-->
    <button type="button" class="btn btn-primary" name="add{{i}}" *ngIf="!obj.toggle" (click) ="obj.getOpenFileChooser()">Adicionar ficheiro</button>
    <button type="button" class="btn btn-primary" name="add{{i}}" *ngIf="obj.toggle" (click) ="obj.getOpenFileChooser()"> Fechar</button>
    <br><br>
    <div *ngIf="obj.toggle">
      <div class="input-group">
        <div class="input-group-prepend">
          <span class="input-group-text" id="inputGroupFileAddon01">Upload</span>
        </div>
        <div class="custom-file">
          <input type="file" class="custom-file-input" id="inputGroupFile01"
            aria-describedby="inputGroupFileAddon01">
          <label class="custom-file-label" for="inputGroupFile01">Escolher ficheiro</label>
        </div>
      </div>
    </div>
    <br><br>
    <div class="row">
      <div class="col-0" *ngIf="i!=0">
        <span (click)="removeItem(i)" class="btn btn-danger">-</span>
      </div>
      <div class="col-1">
        <span (click)="addItem()" class="btn btn-success" >+</span>
      </div>
    </div><hr>
  </div>
  <!--end of item-->
  <br>
  <br>

  <!--total value-->
  <div class="container-fluid">
    <div class="row">
      <div class="col-sm-4">
        <input id="value" type="number" class="form-control" readonly value="{{ total }}">
      </div>
    </div>

    <br>
    <!--<br>-->
    <br><br>
    <button class="btn btn-primary" type="submit" [disabled]="itemForm.invalid"(click)="onSubmit()">Submeter</button>
  </div>
  <br>
  <br>
</form>
  
